/* 🚀 高速スムーズスクロール最適化 */

/* 全体のスクロール最適化 */
* {
  /* GPU加速でスムーズスクロール */
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  -webkit-perspective: 1000;
  perspective: 1000;
}

html {
  scroll-behavior: smooth;
  /* スクロール時のパフォーマンス最適化 */
  -webkit-overflow-scrolling: touch;
  scroll-padding-top: 80px;
}

/* 画像の遷移最適化 */
img {
  /* レイアウトシフト防止 */
  height: auto;
  max-width: 100%;
  
  /* 読み込み時のスムーズ表示 */
  transition: opacity 0.2s ease, filter 0.2s ease, transform 0.2s ease;
  
  /* GPU加速 */
  will-change: transform, opacity;
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  
  /* 重要画像用：即座に表示開始 */
  opacity: 1;
  filter: blur(0);
  
  /* チラつき完全防止 */
  image-rendering: -webkit-optimize-contrast;
  image-rendering: optimizeQuality;
}

/* Next.js Image コンポーネントの最適化 */
[data-nimg] {
  /* 重要画像用：高速表示 */
  transition: opacity 0.1s ease, filter 0.1s ease;
  will-change: opacity, filter;
  transform: translateZ(0);
  
  /* 即座に表示開始（重要画像） */
  opacity: 1 !important;
  filter: blur(0) !important;
  
  /* fill画像の最適化 */
  position: absolute;
  inset: 0;
  object-fit: cover;
  width: 100% !important;
  height: 100% !important;
}

/* 作品カードの最適化 */
.workCard, .mobileWorkCard {
  /* カード全体の最適化 */
  will-change: transform;
  transform: translateZ(0);
  
  /* ホバー時の滑らかな変化 */
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  
  &:hover {
    transform: translateY(-2px) translateZ(0);
  }
}

/* スクロール時のパフォーマンス最適化 */
.worksGrid, .mobileWorksGrid {
  /* コンテナの最適化 */
  contain: layout style paint;
  will-change: transform;
  
  /* 子要素の最適化 */
  > * {
    contain: layout style paint;
  }
}

/* ローディングアニメーションの最適化 */
@keyframes smoothFadeIn {
  0% {
    opacity: 0;
    transform: translateY(10px) translateZ(0);
  }
  100% {
    opacity: 1;
    transform: translateY(0) translateZ(0);
  }
}

.workImageContainer {
  /* 画像コンテナの最適化 */
  animation: smoothFadeIn 0.2s ease forwards;
  will-change: auto;
  
  /* 画像のアスペクト比固定でレイアウトシフト防止 */
  aspect-ratio: 440 / 320;
  overflow: hidden;
  position: relative;
  background-color: #f5f5f5;
  
  img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 1;
    filter: blur(0);
  }
}

/* 重要画像最適化 */
.image-priority-high {
  opacity: 1 !important;
  filter: blur(0) !important;
  transform: translateZ(0) !important;
  transition-duration: 0.05s !important;
}

/* GIF画像最適化 */
img[src*=".GIF"], img[src*=".gif"] {
  image-rendering: -webkit-optimize-contrast;
  image-rendering: crisp-edges;
  transform: translateZ(0);
  will-change: auto;
}

/* フルスクリーンチラつき防止 */
@media (min-width: 1200px) {
  [data-nimg="fill"] {
    contain: layout size paint;
    transform: translateZ(0) !important;
  }
}

/* 🎯 ヒーロー画像専用：真っ白な画面を完全に防止 */
.heroImageWrapper {
  /* 画像再読み込み時の安定性確保 */
  contain: layout style paint;
  will-change: contents;
  
  /* フォールバック背景が常に表示されることを確保 */
  position: relative;
  background: linear-gradient(135deg, #f1f3f4 0%, #e8eaed 50%, #dadce0 100%) !important;
  
  /* 画像キャッシュ強化 */
  img {
    /* ヒーロー画像は絶対にキャッシュから消さない */
    content-visibility: visible !important;
    contain: none !important;
    will-change: auto !important;
    
    /* 真っ白画面防止の最強設定 */
    opacity: 1 !important;
    visibility: visible !important;
    display: block !important;
    
    /* 再読み込み防止の強力な設定 */
    image-rendering: -webkit-optimize-contrast;
    image-rendering: optimizeQuality;
    
    /* 即座に表示 */
    filter: none !important;
    transform: translateZ(0) !important;
    
    /* スクロール時のキャッシュ保持 */
    -webkit-transform: translateZ(0) !important;
    backface-visibility: hidden !important;
    
    /* Next.js Imageのデフォルトスタイルを強制上書き */
    position: relative !important;
    z-index: 2 !important;
  }
  
  /* 読み込み成功後 */
  &.imageLoaded img {
    /* 完全に安定した状態 */
    will-change: auto;
    contain: layout size style paint;
  }
}

/* Next.js Imageコンポーネントの真っ白画面防止 */
.heroSection [data-nimg] {
  /* ヒーローセクション内の全てのImageコンポーネント */
  opacity: 1 !important;
  visibility: visible !important;
  display: block !important;
  transition: none !important;
}

/* ヒーローセクション全体の安定性 */
.heroSection {
  /* セクション全体のキャッシュ最適化 */
  contain: layout style;
  will-change: auto;
  
  /* コンテナの安定性 */
  .heroContainer {
    contain: layout style paint;
    will-change: auto;
    transform: translateZ(0);
  }
}
